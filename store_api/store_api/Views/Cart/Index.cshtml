@{
    ViewBag.Title = "Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@model IEnumerable<store_api.Models.Shopping_Cart>

<div>
    @if (!string.IsNullOrEmpty(ViewBag.SuccessMessage)|| !string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <div class="alert alert-success">
            @ViewBag.SuccessMessage
            @ViewBag.ErrorMessage
        </div>
    }
</div>

<!-- Cart Page Start -->
<div class="container-fluid py-5">
    <div class="container py-5">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Sản phẩm</th>
                        <th scope="col">Tên giày</th>
                        <th scope="col">Giá</th>
                        <th scope="col">Số lượng</th>
                        <th scope="col">Tổng</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <th scope="row">
                                <div class="d-flex align-items-center">
                                    <img src="~/Content/img_giay/@item.Product.Product_image.productimage_url" class="img-fluid me-5 rounded-circle" style="width: 80px; height: 80px;" alt="">
                                </div>
                            </th>
                            <td>
                                <p class="mb-0 mt-4">@item.Product.product_name</p>
                            </td>
                            <td>
                                <p class="mb-0 mt-4">@item.Product.price</p>
                            </td>
                            <td>
                                @using (Html.BeginForm("UpdateCart", "Cart", FormMethod.Post))
                                {
                                    @Html.Hidden("userId", item.user_id)
                                    @Html.Hidden("productId", item.product_id)
                                    <div class="input-group quantity mt-4" style="width: 100px;">
                                        <input type="number" name="quantity" class="form-control form-control-sm text-center border-0" value="@item.quantity">
                                    </div>
                                    <input type="submit" class="btn btn-sm btn-primary mt-2" value="Cập nhật">
                                }
                            </td>
                            <td>
                                <p class="mb-0 mt-4">@((item.quantity * item.Product.price))</p>
                            </td>
                            <td>
                                @using (Html.BeginForm("DeleteCart", "Cart", FormMethod.Post))
                                {
                                    @Html.Hidden("cartid", item.cart_id)
                                    <button type="submit" class="btn btn-md rounded-circle bg-light border mt-4">
                                        <i class="fa fa-times text-danger"></i>
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                    <tr>
                        <td colspan="4"></td>
                        <td colspan="2" class="text-end">
                            @using (Html.BeginForm("CreateOrder", "Checkout", FormMethod.Post))
                            {
                                <div class="input-group mt-4">
                                    <p class="mb-0 mt-2">Địa chỉ giao hàng:</p>
                                    <input type="text" name="shippingAddress" class="form-control" value="@((Model.FirstOrDefault()?.User?.address) ?? "")">
                                </div>
                                <div class="mb-0 mt-2">
                                    Phí vận chuyển: 40.00
                                </div>
                                <input type="hidden" name="totalAmount" value="@((Model.Sum(item => item.quantity * item.Product.price)) + 40)"> <!-- Trường ẩn để chứa tổng giá trị -->
                                <p class="mb-0 mt-2">
                                    <strong>Tổng giá trị:</strong>  @((Model.Sum(item => item.quantity * item.Product.price)) + 40) <!-- Tổng giá trị cộng thêm phí vận chuyển, mặc định là 40.00 -->
                                </p>
                                <button type="submit" class="btn btn-primary mt-2">Đặt hàng</button> <!-- Nút đặt hàng -->
                            }
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- Cart Page End -->
